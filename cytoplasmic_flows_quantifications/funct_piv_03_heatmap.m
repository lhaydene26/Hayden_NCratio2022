function funct_piv_03_heatmap(data_loc, dx, dt)
    % This function accepts a file location, pixel size, and frame rate, loads the velocity fields generated
    % from the previous PIV step and creates a heatmap from the data

    fname = strcat(data_loc, 'velocity_fields2\');

    filePattern = fullfile(fname, '*.mat');
    matFiles = dir(filePattern);

    for i = 1:numel(matFiles)
%         load trajectories and if trajectories are not available, load piv data
        filename1 = strcat(fname, sprintf('velocity_field_%03i.mat',i));
        load(filename1) 
        dxm_all{i,1}=dxm;
        dym_all{i,1}=dym;
        xs_all{i,1}=xs;
        ys_all{i,1}=ys;
        i
    end
    figure,
    for ll= 1:numel(matFiles)
        dxm=dxm_all{ll};
        dym=dym_all{ll};
        x=xs_all{ll};
        y=ys_all{ll};
        dxma(1:length(x),ll)=dxm;

        ls=discretize(x,1:8:1024);
        for i=min(ls):max(ls)
            dxmaa(i,ll)=nanmean(dxm(ls==i));
            if (isnan(dxmaa(i,ll)))
                dxmaa(i,ll) = dxmaa(i-1,ll);
            end
        end
        clear x
        clear y
    %     imagesc(-dxmaa(9:91,:))
    % imagesc(-dxmaa(9:89,:))
    end
    imagesc(sgolayfilt(-dxmaa*dx/dt,3,15),[-0.4, 0.4]); 
%         imagesc(-dxmaa*dx/dt,[-0.4, 0.4]); 
    colormap([0.403,0,0.121;0.460,0,0.130;0.513,0,0.136;0.562,0,0.140;0.607,0,0.141;0.649,0.0252,0.147;0.687,0.0792552525821347,0.162869639626246;0.720429350639388,0.128243618790011,0.182574364784241;0.747441154738189,0.175985514904528,0.202151987841314;0.769960313516976,0.222257079430511,0.221812830043020;0.789573816115776,0.266980627104618,0.242112502154123;0.807951508135040,0.310196115364986,0.263616181049832;0.826853239866531,0.352005967552217,0.286897320819055;0.847843446122888,0.392909740799678,0.312647881473826;0.869283619575729,0.435939870392903,0.341991992650489;0.890084738343700,0.480624747224874,0.374341527124566;0.909741164140572,0.525678827243078,0.408707784243611;0.927836092464814,0.569869640771326,0.444038452440186;0.944052627188400,0.611973419779657,0.479222660841376;0.958177237762342,0.650779033661639,0.513153801473808;0.970063706166305,0.688364658753222,0.550872607231337;0.979464905538157,0.725906741809268,0.594450098823191;0.986216014092135,0.762342303493684,0.641234292386998;0.990358772216156,0.796593909479795,0.688504054151639;0.992190197211105,0.827564350534256,0.733473447549619;0.992279858304234,0.854136429657583,0.773298182364152;0.991909381944028,0.877370685342899,0.808772667040439;0.991858836704319,0.900541552813884,0.845114655123530;0.991085294620358,0.922424149227390,0.880588096722088;0.988574434356553,0.941627811325660,0.913186307150298;0.983379235901074,0.956740714816190,0.940863935910744;0.974612822926746,0.966339915395158,0.961552144152989;0.961437773542250,0.969041685425316,0.973345090881680;0.943688158814424,0.964795350368354,0.976715737899241;0.922174292574119,0.955147501510167,0.973728682733392;0.897711044713406,0.941739941074445,0.966473162787854;0.871047079818503,0.926206888284863,0.957038015048815;0.842858709299984,0.910165534376576,0.947499029682265;0.813612529971342,0.895130057490624,0.939796088990037;0.780128880124935,0.879601119038694,0.931680480234587;0.741956613479238,0.862364762355780,0.921809147221952;0.700710650650881,0.843342370113511,0.910543733325517;0.658093004078659,0.822478405233314,0.898241438749487;0.615944461421893,0.799740712183904,0.885253917322327;0.576292582203672,0.775115560800754,0.871926560276504;0.536601393154104,0.747654701469078,0.857588824628821;0.491693206447890,0.716850162218267,0.841327822355229;0.442827266960171,0.684108314998813,0.823836359954936;0.391207572070378,0.650809689335189,0.805822160423867;0.337944631242493,0.618285329005016,0.787994901293132;0.284138391373838,0.587811132252598,0.771066126323134;0.234068683073536,0.559941074226308,0.756411101860099;0.200321967084344,0.532525026191966,0.745935198936047;0.181472690472897,0.505057317000435,0.737191515107589;0.171621126189420,0.477297700108587,0.727396592295351;0.163162117567479,0.449085435229342,0.713815154987644;0.148302162569902,0.420373339075899,0.693772170244358;0.119163775464067,0.391135981354001,0.664930890749105;0.0859848678044831,0.360393023806602,0.629447250166342;0.0552479563828837,0.328025868860811,0.588715951313000;0.0299007788677588,0.294323113985452,0.543055496459026;0.0173835397648181,0.259582396042130,0.492827931068102;0.0153713881278620,0.224112261444831,0.438447298947406;0.0196078431372557,0.188235294117647,0.380392156862745])
end